<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/assets/images/icon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PX STORE">
    <link rel="apple-touch-icon" href="assets/images/icon-192.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6c63ff">
    <meta name="msapplication-TileColor" content="#6c63ff">
    
    <title>PX STORE | Layanan Premium - Kuota, Pulsa, VPN & Top Up Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS yang sudah ada tetap dipertahankan */
        :root {
            --primary: #6c63ff;
            --primary-dark: #564fd8;
            --secondary: #4d44db;
            --accent: #9d4edd;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-hover: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }
        
        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--secondary) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        #loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
            border-radius: 20px;
            background-color: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 30px rgba(108, 99, 255, 0.5);
        }
        
        .loading-logo img {
            width: 70%;
            height: 70%;
            object-fit: contain;
        }
        
        .loading-text {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .loading-subtext {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* App Container - hidden selama loading */
        .app-container {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .app-container.loaded {
            opacity: 1;
        }
        
        /* CSS yang sudah ada sebelumnya tetap dipertahankan di sini */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease;
            padding-bottom: 80px;
        }
        
        /* ... (CSS yang sudah ada sebelumnya) ... */
        
        /* Perbaikan untuk layout topup options */
        .topup-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 kolom per baris */
            gap: 8px; /* Jarak lebih kecil */
            margin-bottom: 15px;
        }

        .topup-option {
            background-color: var(--dark-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px; /* Border radius lebih kecil */
            padding: 10px 5px; /* Padding lebih kecil */
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            min-height: 60px; /* Tinggi lebih kecil */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .topup-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .topup-option.active {
            border-color: var(--primary);
            background-color: rgba(108, 99, 255, 0.1);
        }

        .topup-amount {
            font-size: 0.9rem; /* Font lebih kecil */
            font-weight: 600;
            margin-bottom: 3px;
        }

        .topup-price {
            font-size: 0.8rem; /* Font lebih kecil */
            color: var(--text-secondary);
        }

        /* Responsive untuk layar lebih kecil */
        @media (max-width: 480px) {
            .topup-options {
                grid-template-columns: repeat(2, 1fr); /* 2 kolom per baris di layar kecil */
                gap: 6px;
            }
            
            .topup-option {
                padding: 8px 4px;
                min-height: 55px;
            }
            
            .topup-amount {
                font-size: 0.85rem;
            }
            
            .topup-price {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 360px) {
            .topup-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .topup-option {
                padding: 6px 3px;
                min-height: 50px;
            }
            
            .topup-amount {
                font-size: 0.8rem;
            }
            
            .topup-price {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">
            <img src="assets/images/icon.ico" alt="PX STORE">
        </div>
        <div class="loading-text">PX STORE</div>
        <div class="loading-subtext">Loading aplikasi...</div>
        <div class="loading-spinner"></div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="progressBar"></div>
        </div>
    </div>
    
    <!-- Overlay animasi slide -->
    <div id="pageTransition" class="page-transition"></div>
    
    <!-- App Container -->
    <div class="app-container">
        <!-- Konten aplikasi yang sudah ada -->
        <div class="header-top">
            <div class="header-left"></div>
            <div class="header-right"></div>
        </div>

        <div class="profile-header">
            <div class="profile-left">
                <div class="profile-icon">
                    <img src="assets/images/icon.ico" alt="PX STORE">
                </div>
                <div>
                    <span class="username">Selamat Datang di PX STORE</span>
                    <div class="points-container">
                        <i class="fas fa-star point-icon"></i>
                        <span class="points" id="userDisplay">Layanan Terpercaya</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container Saldo -->
        <div class="saldo-wrapper">
            <!-- Saldo Biasa -->
            <div class="saldo-container" id="saldoContainer" onclick="openTopupModal()">
                <div class="saldo-content">
                    <div class="saldo-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="saldo-info">
                        <div class="saldo-label">Saldo Anda</div>
                        <div class="saldo-amount" id="saldoAmount">Rp 0</div>
                    </div>
                </div>
                <button class="topup-btn">Top Up</button>
            </div>

            <!-- Saldo QRIS -->
            <div class="saldo-container" id="qrisSaldoContainer" onclick="navigateTo('qris.html')">
                <div class="saldo-content">
                    <div class="saldo-icon">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <div class="saldo-info">
                        <div class="saldo-label">Saldo QRIS</div>
                        <div class="saldo-amount" id="qrisSaldoAmount">Rp 0</div>
                    </div>
                </div>
                <button class="topup-btn">QRIS</button>
            </div>
        </div>

        <!-- Konten lainnya yang sudah ada -->
        <!-- ... -->

    </div>

    <script>
        // Fungsi untuk menampilkan loading screen
        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            const appContainer = document.querySelector('.app-container');
            const progressBar = document.getElementById('progressBar');
            
            // Reset progress bar
            progressBar.style.width = '0%';
            
            // Simulasi progress loading
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    
                    // Sembunyikan loading screen setelah selesai
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        appContainer.classList.add('loaded');
                    }, 500);
                }
                progressBar.style.width = progress + '%';
            }, 200);
        }
        
        // Fungsi untuk memeriksa apakah aplikasi diinstall sebagai PWA
        function isRunningAsPWA() {
            return (window.matchMedia('(display-mode: standalone)').matches) || 
                   (window.navigator.standalone) || 
                   (document.referrer.includes('android-app://'));
        }
        
        // Fungsi untuk menampilkan pesan khusus jika aplikasi diinstall
        function showPWAWelcome() {
            if (isRunningAsPWA()) {
                const loadingSubtext = document.querySelector('.loading-subtext');
                if (loadingSubtext) {
                    loadingSubtext.textContent = "Menyiapkan aplikasi PX STORE...";
                }
            }
        }
        
        // Event listener untuk DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            // Tampilkan pesan khusus untuk PWA
            showPWAWelcome();
            
            // Tampilkan loading screen
            showLoadingScreen();
            
            // Inisialisasi aplikasi setelah loading selesai
            setTimeout(() => {
                initializeApp();
            }, 1500);
        });
        
        // Fungsi inisialisasi aplikasi
        function initializeApp() {
            // Load saldo dari localStorage
            loadSaldo();
            
            // Load saldo QRIS dari localStorage
            loadQrisSaldo();
            
            // Inisialisasi event listener
            initEventListeners();
            
            // Mulai banner slider
            startBannerSlider();
            
            // Cek apakah ada parameter login di URL
            checkLoginParams();
            
            // Tampilkan username
            displayUsername();
            
            // Cek update pengumuman
            checkPengumumanUpdate();
            
            // Jika aplikasi diinstall sebagai PWA, tambahkan event listener khusus
            if (isRunningAsPWA()) {
                setupPWAFeatures();
            }
        }
        
        // Fungsi untuk setup fitur khusus PWA
        function setupPWAFeatures() {
            // Tambahkan event listener untuk mencegah zoom berlebihan
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // Tambahkan event listener untuk mencegah konteks menu default
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            // Optimasi performa untuk PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
        }
        
        // Fungsi-fungsi yang sudah ada sebelumnya
        function loadSaldo() {
            const savedBalance = localStorage.getItem('pxstore_user_balance');
            if (savedBalance !== null) {
                userBalance = parseInt(savedBalance);
            } else {
                userBalance = 0;
                saveSaldo();
            }
            updateSaldo();
        }
        
        function loadQrisSaldo() {
            const savedQrisBalance = localStorage.getItem('pxstore_qris_balance');
            if (savedQrisBalance !== null) {
                qrisBalance = parseInt(savedQrisBalance);
            } else {
                qrisBalance = 0;
                saveQrisSaldo();
            }
            updateQrisSaldo();
        }
        
        // ... (Fungsi-fungsi JavaScript yang sudah ada sebelumnya) ...
        
    </script>
</body>
</html>